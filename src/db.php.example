<?php
// Exemplo seguro de configuração de BD para inclusão no repositório.
// Não coloque segredos neste arquivo. Use variáveis de ambiente em produção.

// Este arquivo demonstra as variáveis que a aplicação suporta:
// DATABASE_URL (ex: mysql://user:pass@host:3306/dbname)
// ou as variáveis individuais: DB_HOST, DB_PORT, DB_DATABASE, DB_USERNAME, DB_PASSWORD

function env_first(array $names, $default = null) {
    foreach ($names as $n) {
        $v = getenv($n);
        if ($v !== false && $v !== '') return $v;
    }
    return $default;
}

$fallback = [
    'host' => '127.0.0.1',
    'port' => 3306,
    'dbname' => 'catechesis',
    'username' => 'root',
    'password' => '',
];

$databaseUrl = env_first(['DATABASE_URL', 'CLEARDB_DATABASE_URL']);
if ($databaseUrl) {
    $parts = parse_url($databaseUrl);
    if ($parts !== false) {
        $host = $parts['host'] ?? $fallback['host'];
        $port = $parts['port'] ?? $fallback['port'];
        $username = $parts['user'] ?? $fallback['username'];
        $password = $parts['pass'] ?? $fallback['password'];
        $dbname = isset($parts['path']) ? ltrim($parts['path'], '/') : $fallback['dbname'];
    }
} else {
    $host = env_first(['DB_HOST','MYSQL_HOST','RAILWAY_HOST'], $fallback['host']);
    $port = env_first(['DB_PORT','MYSQL_PORT'], $fallback['port']);
    $dbname = env_first(['DB_DATABASE','DATABASE_NAME','DB_NAME'], $fallback['dbname']);
    $username = env_first(['DB_USERNAME','MYSQL_USER','DB_USER'], $fallback['username']);
    $password = env_first(['DB_PASSWORD','MYSQL_PASSWORD','DB_PASS'], $fallback['password']);
}

// Exemplo: criar PDO
try {
    $dsn = "mysql:host={$host};port={$port};dbname={$dbname};charset=utf8mb4";
    $pdo = new PDO($dsn, $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
} catch (PDOException $e) {
    // Em produção, logue o erro ao invés de exibir
    echo "Erro ao conectar ao banco: " . $e->getMessage();
}

?>