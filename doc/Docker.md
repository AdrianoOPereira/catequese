## Using docker for CatecheSis development


### On first usage

1. Make a copy of the template file `./src/core/config/catechesis_config.inc.docker.php` and name it `./src/core/config/catechesis_config.inc.php`.

2. Make a copy of the template file `./catechesis_data/config/catechesis_config.shadow.docker.php` and name it `./catechesis_data/config/catechesis_config.shadow.php`.

3. `cd` to the directory `docker` at the root of this repository.

4. Build the container images

    ```$bash
    docker-compose build --no-cache
    ```

5. Launch the web server and database:

    ```$bash
    docker-compose up
    ```

6. Create the default `admin` user by visiting the page `https://localhost/setup/criaAdmin.php` in your web browser.

7. Only after that you may navigate to `https://localhost` and login to CatecheSis with:
    ```$xslt
    username: admin
    password: admin
    ```

8. You can change the default password and/or create other users on the *Catequese > Gerir utilizadores e catequistas* menu.





### Regular usage

1. `cd` to the directory `docker` at the root of this repository.

2. Launch the web server and database:
   
    ```$bash
    docker-compose up
    ```

3. Access CatecheSis through your browser in `https://localhost`.

4. Access the database, if needed, by running the script `./docker/mysql-server/open_client.sh`.


### Shuting down

1. `cd` to the directory `docker` at the root of this repository.

2. Run:
```$bash
docker-compose down
```


### Delete the database

Ensure that the database server is shut down.

1. `cd` to the directory `docker` at the root of this repository.

2. Delete the folder `db` (which belongs to user `root`) with:
    
    ```bash
    sudo rm -r db
    ```
   
On the next run, a new folder `db` and CatecheSis database will be automatically created.
Follow the steps at the top of this guide to setup the `admin` user for the first run.

Other custom data might have been generated by CatecheSis during its usage and stored inside the `catechesis_data` folder and subfolders. You will have to delete those files manually with `sudo rm`.